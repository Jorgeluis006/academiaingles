<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/palette.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
        <!-- Toast visual -->
        <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
            <div id="toast-admin" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body" id="toast-admin-msg">
                        Acción realizada correctamente
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
                </div>
            </div>
        </div>
    <header class="header">
        <div class="header-logo">Mi Sitio</div>
        <nav class="header-nav">
            <a href="index.html">Inicio</a>
            <a href="login.html">Login</a>
        </nav>
    </header>
    <main>
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h2 class="mb-4 text-center" style="color:var(--color-purple)">Panel de Administración</h2>
                            <div class="alert alert-info text-center" style="background:var(--color-mauve);color:var(--color-dark);border:none;">
                                Gestión de cursos: edita, elimina o agrega nuevos cursos para la web.
                            </div>
                            <div id="cursos-admin">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0" style="color:var(--color-purple)">Cursos actuales</h4>
                                    <button class="btn btn-success" id="btn-nuevo-curso" type="button">Agregar curso</button>
                                </div>
                                <div id="cursos-lista" class="row g-4"></div>
                                <div id="form-curso" class="mt-4 d-none">
                                    <h5 id="form-titulo">Agregar nuevo curso</h5>
                                    <form id="cursoForm">
                                        <input type="hidden" id="curso-id">
                                        <div class="mb-2">
                                            <label class="form-label">Título</label>
                                            <input type="text" class="form-control" id="curso-titulo" required>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label">Descripción</label>
                                            <textarea class="form-control" id="curso-desc" rows="2" required></textarea>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label">URL de imagen</label>
                                            <input type="url" class="form-control" id="curso-img" required>
                                        </div>
                                        <div class="mb-2">
                                            <img id="img-preview" src="" alt="Previsualización" style="max-width:180px;max-height:120px;display:none;border-radius:1rem;">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Guardar</button>
                                        <button type="button" class="btn btn-secondary ms-2" id="cancelar-curso">Cancelar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toast visual
        function showToast(msg, success = true) {
            const toast = document.getElementById('toast-admin');
            const toastMsg = document.getElementById('toast-admin-msg');
            toastMsg.textContent = msg;
            toast.classList.remove('text-bg-success', 'text-bg-danger');
            toast.classList.add(success ? 'text-bg-success' : 'text-bg-danger');
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    // --- Gestión de cursos ---
    const cursosLista = document.getElementById('cursos-lista');
    const formCurso = document.getElementById('form-curso');
    const btnNuevoCurso = document.getElementById('btn-nuevo-curso');
    const cursoForm = document.getElementById('cursoForm');
    const cancelarCurso = document.getElementById('cancelar-curso');
    const imgPreview = document.getElementById('img-preview');
    let editando = false;
    let cursos = [];

    function renderCursos() {
        cursosLista.innerHTML = '';
        cursos.forEach(curso => {
            const col = document.createElement('div');
            col.className = 'col-12 col-md-6 col-lg-4';
            col.innerHTML = `
                <div class="card curso-card mb-3 shadow-sm">
                    <img src="${curso.imagen}" alt="${curso.titulo}" style="height:160px;object-fit:cover;border-radius:1.2rem 1.2rem 0 0;">
                    <div class="card-body">
                        <h5 class="card-title">${curso.titulo}</h5>
                        <p class="card-text">${curso.descripcion}</p>
                        <button class="btn btn-sm btn-warning me-2" onclick="editarCurso(${curso.id})">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="eliminarCurso(${curso.id})">Eliminar</button>
                    </div>
                </div>
            `;
            cursosLista.appendChild(col);
        });
    // Fin de renderCursos
// Definir eliminarCurso solo una vez
window.eliminarCurso = function(id) {
    if (!confirm('¿Seguro que deseas eliminar este curso?')) return;
    const formData = new FormData();
    formData.append('id', id);
    fetch('php/cursos.php?action=eliminar', {
        method: 'POST',
        body: formData
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            cargarCursos();
            showToast('Curso eliminado correctamente', true);
        } else {
            showToast(data.msg || 'Error al eliminar', false);
        }
    });
}
    }

    function cargarCursos() {
        fetch('php/cursos.php?action=listar')
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    cursos = data.cursos;
                    renderCursos();
                }
            });
    }

    window.editarCurso = function(id) {
        const curso = cursos.find(c => c.id == id);
        if (!curso) return;
        document.getElementById('curso-id').value = curso.id;
        document.getElementById('curso-titulo').value = curso.titulo;
        document.getElementById('curso-desc').value = curso.descripcion;
        document.getElementById('curso-img').value = curso.imagen;
        imgPreview.src = curso.imagen;
        imgPreview.style.display = 'block';
        document.getElementById('form-titulo').textContent = 'Editar curso';
        formCurso.classList.remove('d-none');
        editando = true;
    }

    btnNuevoCurso.onclick = () => {
        cursoForm.reset();
        document.getElementById('curso-id').value = '';
        imgPreview.style.display = 'none';
        document.getElementById('form-titulo').textContent = 'Agregar nuevo curso';
        formCurso.classList.remove('d-none');
        editando = false;
    };

    cancelarCurso.onclick = () => {
        formCurso.classList.add('d-none');
    };

    document.getElementById('curso-img').oninput = function() {
        if (this.value) {
            imgPreview.src = this.value;
            imgPreview.style.display = 'block';
        } else {
            imgPreview.style.display = 'none';
        }
    };

    cursoForm.onsubmit = function(e) {
        e.preventDefault();
        const id = document.getElementById('curso-id').value;
        const titulo = document.getElementById('curso-titulo').value.trim();
        const descripcion = document.getElementById('curso-desc').value.trim();
        const imagen = document.getElementById('curso-img').value.trim();
        const formData = new FormData();
        formData.append('titulo', titulo);
        formData.append('descripcion', descripcion);
        formData.append('imagen', imagen);
        if (editando) {
            formData.append('id', id);
        }
        fetch('php/cursos.php?action=' + (editando ? 'editar' : 'agregar'), {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                formCurso.classList.add('d-none');
                cargarCursos();
                showToast(editando ? 'Curso editado correctamente' : 'Curso agregado correctamente', true);
            } else {
                showToast(data.msg || 'Error al guardar', false);
            }
        });
    };

    cargarCursos();
    </script>
    <script src="js/main.js"></script>
</body>
</html>